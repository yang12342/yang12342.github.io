
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>Imgui Docking | yang_blog</title>
    <meta name="author" content="yang" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.2.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>YANG_BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;YANG_BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Imgui Docking</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/30
        </span>
        
        <span class="category">
            <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                游戏引擎
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" style="color: #00bcd4">
                    游戏引擎
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="笔记14-Imgui-Docking"><a href="#笔记14-Imgui-Docking" class="headerlink" title="笔记14.Imgui Docking"></a>笔记14.Imgui Docking</h2><p>他承认了确实将imgui_glfw的功能大部分放入了Imgui_Layer中实现了。</p>
<p>之前在imgui的笔记中也说过，cherno将渲染层opengl的imgui文件自己命名ImguiOpenGLRenderer，同时将glfw3的实现抽出来放在了imguiLayer中的文件中。</p>
<p>但是这样自己维护和功能的更新就带来了麻烦</p>
<span id="more"></span>

<hr>
<ol>
<li><p>虽然视频更新了拉取的Docking分支库，但是最新的imgui显然整合了这个功能，所以不太需要追踪分支。</p>
</li>
<li><p>在此之前还是说一下imgui的使用。</p>
</li>
</ol>
<p>我们在文档中看到使用方法</p>
<blockquote>
<h2 id="Example-If-you-are-using-GLFW-OpenGL-WebGL-示例：如果您使用的是-GLFW-OpenGL-WebGL"><a href="#Example-If-you-are-using-GLFW-OpenGL-WebGL-示例：如果您使用的是-GLFW-OpenGL-WebGL" class="headerlink" title="Example: If you are using GLFW + OpenGL&#x2F;WebGL 示例：如果您使用的是 GLFW + OpenGL&#x2F;WebGL"></a>Example: If you are using GLFW + OpenGL&#x2F;WebGL 示例：如果您使用的是 GLFW + OpenGL&#x2F;WebGL</h2><p>Full standalone example: <a target="_blank" rel="noopener" href="https://github.com/ocornut/imgui/blob/master/examples/example_glfw_opengl3/main.cpp">example_glfw_opengl3&#x2F;main.cpp</a><br>完整独立示例：<a target="_blank" rel="noopener" href="https://github.com/ocornut/imgui/blob/master/examples/example_glfw_opengl3/main.cpp">example_glfw_opengl3&#x2F;main.cpp</a></p>
<p>Add to Includes: 添加到包含：</p>
<pre><code>#include &quot;imgui.h&quot;
#include &quot;imgui_impl_glfw.h&quot;
#include &quot;imgui_impl_opengl3.h&quot;
</code></pre>
<p>Add to Initialization: 添加到初始化：</p>
<pre><code>// Setup Dear ImGui context
IMGUI_CHECKVERSION();
ImGui::CreateContext();
ImGuiIO&amp; io = ImGui::GetIO();
io.ConfigFlags |= ImGuiConfigFlags_NavEnableKeyboard;     // Enable Keyboard Controls
io.ConfigFlags |= ImGuiConfigFlags_NavEnableGamepad;      // Enable Gamepad Controls
io.ConfigFlags |= ImGuiConfigFlags_DockingEnable;         // IF using Docking Branch

// Setup Platform/Renderer backends
ImGui_ImplGlfw_InitForOpenGL(YOUR_WINDOW, true);          // Second param install_callback=true will install GLFW callbacks and chain to existing ones.
ImGui_ImplOpenGL3_Init();
</code></pre>
<p>Add to start of main loop:<br>添加到 main 循环的开头：</p>
<pre><code>// (Your code calls glfwPollEvents())
// ...
// Start the Dear ImGui frame
ImGui_ImplOpenGL3_NewFrame();
ImGui_ImplGlfw_NewFrame();
ImGui::NewFrame();
ImGui::ShowDemoWindow(); // Show demo window! :)
</code></pre>
<p>Add to end of main loop:<br>添加到 main 循环的末尾：</p>
<pre><code>// Rendering
// (Your code clears your framebuffer, renders your other stuff etc.)
ImGui::Render();
ImGui_ImplOpenGL3_RenderDrawData(ImGui::GetDrawData());
// (Your code calls glfwSwapBuffers() etc.)
</code></pre>
<p>Add to Shutdown: 添加到关机：</p>
<pre><code>ImGui_ImplOpenGL3_Shutdown();
ImGui_ImplGlfw_Shutdown();
ImGui::DestroyContext();
</code></pre>
<p>That should be all! 这应该就是全部！</p>
</blockquote>
<ul>
<li>我们先解释一下头文件吧</li>
</ul>
<p><code>imgui.h</code> 是 ImGui 的核心框架，提供了通用的 UI 逻辑，提供了逻辑的抽象层，具体的需要在对应的后端cpp中进行实现。</p>
<p><code>&quot;imgui_impl_glfw.h&quot;</code> 是与操作系统相关的输入和窗口管理实现，让 ImGui 能够响应用户输入和处理窗口事件，就是将glfw的对设备输入的检查函数与imgui中的回调函数函数挂钩，让imgui能够接收到对应的事件。</p>
<p>但是我们要注意使用这个头文件的前提，是你引入了glfw的库，我们在<code>imgui_impl_glfw.cpp</code>中可以看到需要你按照他的路径方式来导入glfw库，这样才能调用glfw的库函数。</p>
<img src="./image-20241126172750986.png" alt="image-20241126172750986" style="zoom:80%;" />

<p><code>imgui_impl_openGL.h</code> 使用 OpenGL 渲染 API，将 UI 绘制数据翻译成实际的图形指令并渲染到屏幕上。</p>
<p>要注意imgui又是如何加载openGL的函数地址呢，我们可以看到（默认没有定义I<strong>MGUI_IMPL_OPENGL_LOADER_CUSTOM</strong>，只不过是我定义的），在<code>imgui_impl_openGL.cpp </code>文件中引入了<code>imgui_impl_opengl3_loader.h</code>,点进去阅读文档，你会发现就是一个小型的opengl函数地址加载器。</p>
<p>和你直接引入<code>&lt;glad/glad.h&gt;</code>的区别就在于：</p>
<ul>
<li>loader会引入imgui中需要的函数地址，而不会多余的加载，从而实现了小体量，关于loader的具体方式，是使用脚本什么的来加载，较为复杂，可以自己参阅源代码中Loader的gl3w的实现库去。</li>
</ul>
<blockquote>
<p>另外补充一点，他怎么知道你使用的glad还是glew来加载openGL的？</p>
<p>因为OpenGL是规范，各个库只是加载函数的方式不同，但是函数名称和接口规范都是大体一致的，所以不管你使用哪一个，他只要使用规范的OpenGL函数就可以实现渲染逻辑。</p>
</blockquote>
<img src="./image-20241126173015497.png" alt="image-20241126173015497" style="zoom:80%;" />

<p><strong>完整工作流</strong>：</p>
<ul>
<li><strong><code>imgui_impl_glfw</code></strong> 收集用户输入（鼠标、键盘）并将其反馈给核心框架。</li>
<li><strong><code>imgui_impl_dx12</code></strong> 根据核心框架生成的绘制数据，将 UI 渲染到屏幕。</li>
</ul>
<hr>
<ul>
<li>TO DO</li>
</ul>
<p>主循环的逻辑部分到时候，就是上面的示例。</p>
<hr>
<ol start="3">
<li>我们先把前面的头文件的实现都放在一个翻译单元（CPP文件）</li>
</ol>
<p>所以我们呢创建了<code>ImGUiBuild.cpp</code></p>
<pre><code class="CPP">#include &quot;hzpch.h&quot;


#include &quot;backends/imgui_impl_glfw.cpp&quot;
#include &quot;backends/imgui_impl_opengl3.cpp&quot;
</code></pre>
<p>各自的cpp文件自带头文件，这样所有函数都实现了，之后我们只需要的时候只要引入对应的头文件就好了。</p>
<hr>
<ol>
<li>首先删除了OpenGL文件夹下的文件（因为已经有了现成的，在build中包含）</li>
<li>然后大体重写了imguiLayer的结构</li>
</ol>
<pre><code class="CPP">//imguiLayer.h
class  ImGuiLayer: public Layer
&#123;
public:
    ImGuiLayer();
    ~ImGuiLayer();


    virtual void OnAttach() override;			//创建imgui所需的初始化操作
    virtual void OnDetach() override;			//删除imgui的卸载资源等操作
    virtual void OnImGuiRender()override;		//渲染所需内容

    void Begin();								//每一帧渲染前的初始化
    void End();									//处理所有渲染数据并提交渲染数据，更新渲染所有窗口

private:
    float m_Time = 0.0f;
&#125;;

//imguiLayer.cpp
ImGuiLayer::ImGuiLayer()
&#123;

&#125;

ImGuiLayer::~ImGuiLayer()
&#123;

&#125;

void ImGuiLayer::OnAttach()
&#123;
    //Setup Dear ImGui context
    IMGUI_CHECKVERSION();
    ImGui::CreateContext();
    ImGuiIO&amp; io = ImGui::GetIO();
    io.ConfigFlags |= ImGuiConfigFlags_NavEnableKeyboard;		//Enable Keyboards Controls
    //io.configFlags |=ImGuiConfigFlags_NavEnableGamepad;		//Enable Gamepad Controls
    io.ConfigFlags |= ImGuiConfigFlags_DockingEnable;			//Enable Docking
    io.ConfigFlags |= ImGuiConfigFlags_ViewportsEnable;			//Enable Multi-Viewport / Platform Windows
    //io.ConfigFlags |= ImGuiConfigFlags_ViewportsNoTaskBarIcons;
    //io.ConfigFlags |= ImGuiConfigFlags_ViewportsNomerge;	

    //Setup Dear ImGui style
    ImGui::StyleColorsDark();
    //ImGui::StyleColorClassic();

    //When viewports are enabled we tweak windowsRounding/WindowBg so platform windows can look identical
    ImGuiStyle&amp; style = ImGui::GetStyle();
    if (io.ConfigFlags &amp; ImGuiConfigFlags_ViewportsEnable)
    &#123;
        style.WindowRounding = 0.0f;
        style.Colors[ImGuiCol_WindowBg].w = 1.0f;
    &#125;

    Application&amp; app = Application::Get();
    GLFWwindow* window = static_cast&lt;GLFWwindow*&gt;(app.GetWindow().GetNativeWindow());

    //Setup platform/Renderer bindings



    ImGui_ImplGlfw_InitForOpenGL(window, true);
    ImGui_ImplOpenGL3_Init();
&#125;

void ImGuiLayer::OnDetach()
&#123;
    ImGui_ImplOpenGL3_Shutdown();
    ImGui_ImplGlfw_Shutdown();
    ImGui::DestroyContext();

&#125;

void ImGuiLayer::OnImGuiRender()
&#123;
    static bool show = true;
    ImGui::ShowDemoWindow(&amp;show);
&#125;

void ImGuiLayer::Begin()
&#123;
    //它们分别处理 OpenGL 和 GLFW 的新帧初始化，例如处理输入、刷新状态等。
    ImGui_ImplOpenGL3_NewFrame();
    ImGui_ImplGlfw_NewFrame();
    //告诉 ImGui 开始一帧新的绘制操作。所有的 UI 绘制操作都应该在 NewFrame 和 Render 之间完成。
    ImGui::NewFrame();
&#125;

void ImGuiLayer::End()
&#123;
    ImGuiIO&amp; io = ImGui::GetIO();
    Application&amp; app = Application::Get();

    io.DisplaySize = ImVec2((float)app.GetWindow().GetWidth(), (float)app.GetWindow().GetHeight());

    //Rendering
    ImGui::Render();
    ImGui_ImplOpenGL3_RenderDrawData(ImGui::GetDrawData());


    if (io.ConfigFlags &amp; ImGuiConfigFlags_ViewportsEnable)
    &#123;
        //由于每个窗口可能有自己的 OpenGL 上下文，所以需要使用 glfwMakeContextCurrent() 恢复之前的上下文。
        GLFWwindow* backup_current_context = glfwGetCurrentContext();
        ImGui::UpdatePlatformWindows();
        ImGui::RenderPlatformWindowsDefault();
        glfwMakeContextCurrent(backup_current_context);
    &#125;
&#125;
</code></pre>
<img src="./image-20241130145831086.png" alt="image-20241130145831086" style="zoom:67%;" />

<ol start="3">
<li>调试imgui显然属于引擎层面的，我们放入Application.cpp中实现渲染，依旧是layer的放入和使用方法。</li>
</ol>
<p>但是又如下的修改。</p>
<ul>
<li>layerstack的对应layer获取放弃了迭代器选择了索引计算位置。</li>
</ul>
<pre><code class="CPP">void LayerStack::PushLayer(Layer* layer)
&#123;
    //m_LayerInsertIndex是Layer中前半层和后半层的中间
    m_Layers.emplace(m_Layers.begin()+m_LayerInsertIndex, layer);
    m_LayerInsertIndex++;
&#125;
</code></pre>
<blockquote>
<p>为什么数组的迭代器能够与unsigned int直接相加计算到迭代器地址？</p>
<p>因为内部实现了迭代器和整数相机的重载，从而可以计算对应的偏移量，获得对应位置的指针。</p>
</blockquote>
<ul>
<li>原本使用uniqe_ptr指针存储imguiLayer，中途换成了普通指针储存</li>
</ul>
<p>因为layer统一需要放进layerstack中进行管理，而layerstack却又是vector数组实现的</p>
<p>上面看到，存放是通过<code>emplace</code>实现的。</p>
<p><code>std::unique_ptr</code> 是一种智能指针，它独占其所指向的资源的所有权，因此 <code>std::unique_ptr</code> 是不可复制的，拷贝构造和拷贝赋值操作被禁用，但是支持移动构造和移动赋值，允许资源从一个 <code>std::unique_ptr</code> 转移到另一个 <code>std::unique_ptr</code>。</p>
<p>而<code>emplace</code>容器的内存区域直接构造对象（原地构造），而不是插入一个现有的对象。</p>
<blockquote>
<p>移动可以通过 <code>emplace_back(std::move(ptr))</code> 明确实现，避免语义不清</p>
</blockquote>
<p>所以最后使用了普通指针存放imguiLayer。</p>
<img src="./image-20241130151648277.png" alt="image-20241130151648277" style="zoom:80%;" />

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 yang_blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;yang
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
