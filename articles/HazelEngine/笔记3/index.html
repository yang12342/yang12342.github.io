
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>Premake | yang_blog</title>
    <meta name="author" content="yang" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.2.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>YANG_BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;YANG_BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Premake</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/10/28
        </span>
        
        <span class="category">
            <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                游戏引擎
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" style="color: #ffa2c4">
                    游戏引擎
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="HazelEngine笔记3"><a href="#HazelEngine笔记3" class="headerlink" title="HazelEngine笔记3"></a>HazelEngine笔记3</h1><p>premake是一个开源的脚本生成工具，利用lua脚本自定义项目配置，自动生成对应的的IDE和编译器的构建文件。至于能配置哪些，我会从项目的配置文件中解释，而不是一一列举了。</p>
<span id="more"></span>

<p>由于我生成的vs的文件，所以在此之前我们可以看看vs有哪些配套（除去源代码）的文件。</p>
<ol>
<li>项目的配套文件</li>
</ol>
<p>每个项目里都会有以下几个文件<img src="./笔记三-premake/image-20241026165102703.png" alt="image-20241026165102703" style="zoom:67%;" /></p>
<p>我们分别来看看各自文件的作用</p>
<ul>
<li><p>.vcxproj文件是 Visual Studio 单个项目的核心配置文件，其中存储的重要的构建和配置信息。例如文件路径，平台配置，构建配置（debug还是release），外部依赖项等等我们可以在项目属性中的配置的一些东西都放在里面。</p>
<img src="./image-20241026165418833.png" alt="image-20241026165418833" style="zoom:50%;" />
</li>
<li><p>.user文件通常是一个<strong>用户特定的配置文件</strong>，用于存储与用户偏好和开发环境相关的设置。</p>
</li>
</ul>
<p>文件采用了XML的格式，开头声明了XML文件的版本和编码方式（utf-8中文好像会乱码）</p>
<p>然后便是<code>&lt;Project&gt;</code> 标签定义了一个 MSBuild 项目，然后<code>&lt;PropertyGroup&gt;</code> 用于定义项目的属性。在这里，<code>&lt;ShowAllFiles&gt;</code> 设置为 <code>true</code>，表示在 Visual Studio 中<strong>显示所有文件</strong>。</p>
<img src="./image-20241026165507403.png" alt="image-20241026165507403" style="zoom:67%;" />

<ul>
<li><code>.filters</code> 文件用于 Visual Studio 的项目组织，帮助开发者在解决方案资源管理器中将文件分组显示。它的文件名通常是项目文件的名称，后缀为 <code>.filters</code>，例如 <code>MyProject.vcxproj.filters</code>。</li>
</ul>
<img src="./image-20241026165926939.png" alt="虚拟的文件结构" style="zoom:50%;" />

<p><strong>组织文件结构</strong>：例如，在 C++ 项目中，<code>.filters</code> 文件可以让你在 Visual Studio 的解决方案资源管理器中将头文件、源文件、资源文件分组。</p>
<p><strong>虚拟文件分组</strong>：<code>.filters</code> 文件只影响 Visual Studio 中的文件显示，<strong>并不会影响物理文件夹结构，帮忙规整。</strong></p>
<p><strong>提高项目可读性</strong>：方便开发者快速找到项目中不同类型的文件。</p>
<img src="./image-20241026170225996.png" alt="image-20241026170225996" style="zoom:50%;" />

<p>当我们创建vs解决方案的时候倘若不点击“显示所有文件”，那么当前目录都是虚拟的文件夹，只有点开显示所有文件，才能创建真正的物理文件结构。</p>
<ol start="2">
<li>项目的中间文件和输出文件。</li>
</ol>
<p>在每个项目的编译过程中都会有中间文件的产生和最终输出文件的产生。</p>
<img src="./image-20241026170511495.png" alt="image-20241026170511495" style="zoom:50%;" />

<p>默认都在项目的bin文件内，当然可以自己在项目的属性文件中配置，例如当前的dll文件。</p>
<ol start="3">
<li>隐藏的.vs文件</li>
</ol>
<p>在 Visual Studio 项目中，<code>.vs</code> 文件夹是一个<strong>隐藏文件夹</strong>，用于存储与项目和开发环境相关的本地配置和临时文件。它通常位于项目的根目录中，但不会包含在源代码管理（如 Git）中，因为它只在本地环境中使用，不影响项目的实际代码或构建。</p>
<h3 id="vs-文件夹的作用"><a href="#vs-文件夹的作用" class="headerlink" title=".vs 文件夹的作用"></a><code>.vs</code> 文件夹的作用</h3><ol>
<li><strong>存储调试和窗口布局配置</strong>：包含调试信息、窗口布局和设置等，使你每次打开项目时都能看到上次离开时的开发环境。</li>
<li><strong>调试缓存文件</strong>：在调试时，Visual Studio 会将缓存数据存储在 <code>.vs</code> 文件夹中，比如断点和调试配置。</li>
<li><strong>解决方案的用户设置</strong>：<code>.vs</code> 文件夹中有一个 <code>.suo</code> 文件（Solution User Options），用于保存用户的个人配置，比如最后打开的文件、窗口布局和书签等。</li>
<li><strong>IntelliSense 缓存</strong>：该文件夹中有时候会包含 IntelliSense 的缓存数据，这些数据用于加速代码分析和自动补全。</li>
</ol>
<h3 id="vs-文件夹的常见内容"><a href="#vs-文件夹的常见内容" class="headerlink" title=".vs 文件夹的常见内容"></a><code>.vs</code> 文件夹的常见内容</h3><ul>
<li><strong><code>.suo</code> 文件</strong>：包含与用户相关的设置。</li>
<li><strong><code>v16</code>、<code>v17</code> 等版本文件夹</strong>：这类文件夹保存了项目在不同版本的 Visual Studio 中的相关配置。</li>
</ul>
<h3 id="为什么-vs-文件夹不应被加入版本控制"><a href="#为什么-vs-文件夹不应被加入版本控制" class="headerlink" title="为什么 .vs 文件夹不应被加入版本控制"></a>为什么 <code>.vs</code> 文件夹不应被加入版本控制</h3><p><code>.vs</code> 文件夹是特定于用户和本地环境的，它不包含项目的实际代码或资源。如果加入版本控制，会导致不同开发者的本地环境配置冲突。因此，通常在 <code>.gitignore</code> 文件中忽略该文件夹：</p>
<hr>
<p>然后我们就来看看基本的premake内容都有哪些东西</p>
<pre><code class="lua">//定义一个Hazel的工作区，该工作区包含所有项目的配置
workspace &quot;Hazel&quot;
    architecture &quot;x64&quot;			//项目架构位x64，64位操作系统

//configurations：定义三种构建配置：Debug、Release 和 Dist（发行版本）。
    configurations
    &#123;
        &quot;Debug&quot;,
        &quot;Release&quot;,
        &quot;Dist&quot;
    &#125;

//首先这是定义一个输出路径的字符串，方便后面使用
//cfg是配置的意思，buildcfg指的是当前构建的配置选项例如Debug，然后是系统Windows，最后是系统架构，都
//是配置的内容
outputdir = &quot;%&#123;cfg.buildcfg&#125;-%&#123;cfg.system&#125;-%&#123;cfg.architecture&#125;&quot;

-- Include directories relative to root folder (solution directory)
//创建一个包含目录的表格，采用字符串映射的方式便捷设置一些路径
//例如这里就是GLFW映射为以下的路径。
IncludeDir = &#123;&#125;
IncludeDir[&quot;GLFW&quot;] = &quot;Hazel/vendor/GLFW/include&quot;

//包含外部 Premake 文件，指向 GLFW 库的 Premake 配置（例如 premake5.lua 文件）。
//这就是为什么我们不把GLFW的项目配置写在这里了
include &quot;Hazel/vendor/GLFW&quot;


//定义为Hazel的项目，地址位于根目录的Hazel文件下，指定项目为共享库（DLL文件）指定项目语言为C++
//采用c++的编译器
project &quot;Hazel&quot;
    location &quot;Hazel&quot;
    kind &quot;SharedLib&quot;
    language &quot;C++&quot;

//targetdir：将生成的二进制文件输出到 bin/ 目录下，文件夹结构为 bin/配置-系统-架构/项目名。
//objdir：将中间文件（如 .obj 文件）存放到 bin-int/ 目录下，路径与目标目录相似。
    targetdir(&quot;bin/&quot; ..outputdir .. &quot;/%&#123;prj.name&#125;&quot;)
    objdir (&quot;bin-int/&quot; ..outputdir .. &quot;/%&#123;prj.name&#125;&quot;)

//pchheader：指定预编译头文件的名称（hzpch.h）。
//pchsource：指定预编译头的实现文件（hzpch.cpp）。
    pchheader &quot;hzpch.h&quot;
    pchsource &quot;Hazel/src/hzpch.cpp&quot;

//files：指定要包含在项目中的源文件，%&#123;prj.name&#125; 会被替换为 Hazel，因为当前的项目为Hazel

    files
    &#123;
        &quot;%&#123;prj.name&#125;/src/**.h&quot;,
        &quot;%&#123;prj.name&#125;/src/**.cpp&quot;
    &#125;
//includedirs：定义要包含的头文件目录，包括项目的源目录、spdlog 日志库目录和 GLFW 目录。
//就是把需要包含的默认系统查询目录都放进去

    includedirs
    &#123;
        &quot;%&#123;prj.name&#125;/src&quot;,
        &quot;%&#123;prj.name&#125;/vendor/spdlog/include&quot;,
        &quot;%&#123;IncludeDir.GLFW&#125;&quot;
    &#125;

//links：链接到外部库，包括 GLFW 和 OpenGL（Windows 上的 opengl32.lib）。
    links
    &#123;
        &quot;GLFW&quot;,
        &quot;opengl32.lib&quot;

    &#125;

//平台和配置过滤，
//filter &quot;system&quot;：针对 Windows 平台的配置。
//cppdialect &quot;C++17&quot;：
//将 C++ 语言标准设为 C++17。
//staticruntime &quot;On&quot;：设置运行时库为静态链接。
//systemversion &quot;latest&quot;：使用 Windows SDK 的最新版本

    filter &quot;system:windows&quot;
        cppdialect &quot;C++17&quot;
        staticruntime &quot;On&quot;
        systemversion &quot;latest&quot;

//这里是当前项目的预定义宏
        defines
        &#123;
            &quot;HZ_PLATFORM_WINDOWS&quot;,
            &quot;HAZEL_BUILD_DLL&quot;
        &#125;

// 指定了一组在项目编译完成后立即执行的命令。这些命令通常用于将生成的二进制文件复制到特定位置，或执行其他自动化步骤。这里明显是把Hazel生成dll文件复制到Sandbox的文件输出目录下
//postbuildcommands是构建完毕后要执行的命令意思
//%&#123;cfg.buildtarget.relpath&#125;这个是指构建文件目标也是就DLL文件的相对路径
//后面的../bin/&quot; ..outputdir .. &quot;/Sandbox则是输出到当前目录下。
        postbuildcommands
        &#123;
            (&quot;&#123;COPY&#125; %&#123;cfg.buildtarget.relpath&#125; ../bin/&quot; ..outputdir .. &quot;/Sandbox&quot;)
        &#125;
        
//接下来则是针对不同的项目配置，设置宏和构建选项。
//如果是Debug，则定义一个宏，设置为使用调试版本的动态链接运行时库（/MDd）。启用调试符号（symbol）

        filter &quot;configurations:Debug&quot;
            defines &quot;HZ_DEBUG&quot;
            buildoptions &quot;/MDd&quot;
            symbols &quot;On&quot;
//如果是发布版本，定义一个宏，然后/MD：使用发布版本的动态运行时库，启用优化（optimize）

        filter &quot;configurations:Release&quot;
            defines &quot;HZ_RELEASE&quot;
            buildoptions &quot;/MD&quot;
            optimize &quot;On&quot;
//HZ_DIST：定义为发行模式。
//MD 和 optimize &quot;On&quot;：启用运行时和优化
        filter &quot;configurations:Dist&quot;
            defines &quot;HZ_DIST&quot;
            buildoptions &quot;/MD&quot;
            optimize &quot;On&quot;

//这个我就不多讲了
project &quot;Sandbox&quot;
        location &quot;Sandbox&quot;
        kind &quot;ConsoleApp&quot;
        language &quot;C++&quot;

        targetdir(&quot;bin/&quot; ..outputdir .. &quot;/%&#123;prj.name&#125;&quot;)
        objdir (&quot;bin-int/&quot; ..outputdir .. &quot;/%&#123;prj.name&#125;&quot;)
    
        files
        &#123;
            &quot;%&#123;prj.name&#125;/src/**.h&quot;,
            &quot;%&#123;prj.name&#125;/src/**.cpp&quot;
        &#125;
    
        includedirs
        &#123;
            &quot;Hazel/vendor/spdlog/include&quot;,
            &quot;Hazel/src&quot;
        &#125;
        
        links
        &#123;
            &quot;Hazel&quot;
        &#125;

        filter &quot;system:windows&quot;
            cppdialect &quot;C++17&quot;
            staticruntime &quot;On&quot;
            systemversion &quot;latest&quot;
        
            defines
            &#123;
                &quot;HZ_PLATFORM_WINDOWS&quot;
            &#125;
            
            filter &quot;configurations:Debug&quot;
                defines &quot;HZ_DEBUG&quot;
                buildoptions &quot;/MDd&quot;
                symbols &quot;On&quot;
    
            filter &quot;configurations:Release&quot;
                defines &quot;HZ_RELEASE&quot;
                buildoptions &quot;/MD&quot;
                optimize &quot;On&quot;
    
            filter &quot;configurations:Dist&quot;
                defines &quot;HZ_DIST&quot;
                buildoptions &quot;/MD&quot;
                optimize &quot;On&quot;
</code></pre>
<ol>
<li>为什么明明是生成dll文件的Hazel项目，选择静态链接运行时库</li>
</ol>
<p>首先解释一下这二者控制的内容不同，生成dll文件指的是项目导出的函数和数据都可以被其他程序调用。但是导出dll的项目同时也需要运行时库的内容</p>
<blockquote>
<p>运行时库是一组支持程序在运行时执行特定功能的库，通常包括标准库、系统函数等代码。它为应用程序提供基本的低层次功能和系统调用接口，使程序能以更高层次的方式编写和执行，而无需重复实现这些底层功能。</p>
<p>例如基本的内存管理，I&#x2F;O操作，线程等标准库的内用</p>
</blockquote>
<p>静态链接指的是这些库是否需要包含在导出的dll文件内，如果不使用静态运行库链接（反之就是动态运行库链接），那么该文件导出的dll必须使用。运行库的dll才能运行，但是选择静态运行库链接，这些就会被直接包含在导出的dll文件，而不需要依赖外在运行库dll了。</p>
<p>vs里面就是这个属性页面配置</p>
<img src=".e/image-20241026181442274.png" alt="image-20241026181442274" style="zoom: 50%;" />

<p>Visual Studio 提供以下几种常用选项：</p>
<ul>
<li>**<code>/MD</code>**：动态链接多线程运行时库（Release 版的 DLL 版本）。</li>
<li>**<code>/MDd</code>**：动态链接多线程运行时库（Debug 版的 DLL 版本）。</li>
<li>**<code>/MT</code>**：静态链接多线程运行时库（Release 版的静态库版本）。</li>
<li>**<code>/MTd</code>**：静态链接多线程运行时库（Debug 版的静态库版本）。</li>
</ul>
<p>选择 <code>/MD</code> 或 <code>/MDd</code> 表示动态链接，选择 <code>/MT</code> 或 <code>/MTd</code> 表示静态链接。</p>
<p>这样就顺便解决了之前的疑惑了。</p>
<ol start="2">
<li>premake5.exe是如何找到我们的lua配置文件呢</li>
</ol>
<p>因为是在配置文件的目录下使用命令行启用，所以搜索路径有显示当前命令行所在的目录。那么glfw的我们显然也是在上面的配置中包含了其目录，自然会查找配置好。</p>
<h3 id="bat文件使用"><a href="#bat文件使用" class="headerlink" title=".bat文件使用"></a>.bat文件使用</h3><p><code>.bat</code> 文件是批处理文件（Batch File），是一种用于自动化执行命令行任务的脚本文件。在 Windows 操作系统中，批处理文件包含一系列命令，这些命令会按照它们在文件中的顺序逐行执行。</p>
<p>我们把基本的命令行操作放在bat文件里面，然后双击就会自动调用命令行。于是我们把premake的调用写进去。</p>
<img src="./image-20241026183048359.png" alt="image-20241026183048359" style="zoom:80%;" />

<p><strong>call</strong>：这是一个批处理命令，用于调用另一个批处理文件或程序。在这种情况下，它确保在调用的程序执行完后，控制权返回到当前批处理文件。</p>
<p><strong>vendor\bin\premake\premake5.exe</strong>：这是 <code>premake5.exe</code> 可执行文件的路径，表示在 <code>vendor\bin\premake</code> 目录下。</p>
<p><strong>vs2022</strong>：这是传递给 <code>premake5.exe</code> 的参数，指示它生成适用于 Visual Studio 2022 的项目配置。</p>
<p>至此我们只要双击就能自动生成我们自定义配置的项目了。</p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 yang_blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;yang
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
